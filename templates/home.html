<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CampusCart</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      overflow-x: hidden;
    }

    .fill-item {
      position: fixed; 
      z-index: 0;
      opacity: 0.5; 
      pointer-events: none;
      font-size: 28px;
      color: transparent;
      text-shadow: 0 0 0 #dbb048; 
      animation: floatAnim 6s ease-in-out infinite;
    }

    .shape-L { width: 14px; height: 14px; border-top: 4px solid #dbb048; border-right: 4px solid #dbb048; border-top-right-radius: 4px; }
    .shape-circle { width: 10px; height: 10px; border: 2px solid #dbb048; border-radius: 50%; }
    .shape-dot { width: 8px; height: 8px; background-color: #dbb048; border-radius: 50%; }
    .shape-rect { width: 6px; height: 16px; background-color: #dbb048; border-radius: 3px; }

    .z1 { top: 2%; left: 5%; transform: rotate(15deg); } 
    .z2 { top: 5%; left: 30%; font-size: 22px; } 
    .z3 { top: 3%; right: 35%; font-size: 26px; transform: rotate(-10deg); } 
    .z4 { top: 6%; right: 10%; font-size: 22px; } 
    .z5 { top: 18%; left: 12%; transform: rotate(-20deg); } 
    .z6 { top: 15%; right: 25%; transform: rotate(10deg); font-size: 30px; } 
    .z7 { top: 22%; right: 5%; font-size: 20px; opacity: 0.3; } 
    .z8  { top: 35%; left: 4%; font-size: 32px; transform: rotate(5deg); } 
    .z9  { top: 40%; left: 22%; font-size: 20px; opacity: 0.4; transform: rotate(45deg); } 
    .z10 { top: 32%; right: 12%; font-size: 30px; transform: rotate(-15deg); } 
    .z11 { top: 42%; right: 30%; font-size: 24px; opacity: 0.4; } 
    .z12 { top: 55%; left: 8%; font-size: 28px; transform: rotate(-10deg); } 
    .z13 { top: 60%; left: 25%; font-size: 18px; transform: rotate(90deg); } 
    .z14 { top: 52%; right: 15%; font-size: 34px; transform: rotate(20deg); } 
    .z15 { top: 65%; right: 5%; font-size: 20px; } 
    .z16 { top: 75%; left: 5%; font-size: 30px; transform: rotate(15deg); } 
    .z17 { top: 82%; left: 20%; font-size: 24px; opacity: 0.4; } 
    .z18 { top: 72%; right: 25%; font-size: 22px; transform: rotate(-30deg); } 
    .z19 { top: 80%; right: 8%; font-size: 30px; transform: rotate(10deg); } 
    .z20 { top: 90%; left: 12%; font-size: 26px; transform: rotate(-5deg); } 
    .z21 { top: 95%; left: 35%; font-size: 22px; opacity: 0.3; } 
    .z22 { top: 92%; right: 35%; font-size: 26px; transform: rotate(25deg); } 
    .z23 { top: 88%; right: 15%; font-size: 28px; transform: rotate(-10deg); } 
    .z24 { top: 96%; left: 45%; font-size: 20px; opacity: 0.3; } 

    @keyframes floatAnim {
      0%, 100% { transform: translateY(0px) rotate(var(--r, 0deg)); }
      50% { transform: translateY(-8px) rotate(var(--r, 0deg)); }
    }

    .category-pill {
      cursor: pointer;
      transition: all 0.2s;
    }
    .category-pill.active {
      background-color: #000;
      color: #fff;
    }
  </style>
</head>

<body class="bg-[#FFD573] min-h-screen relative">

  <div class="fill-item z1">üçï</div> <div class="fill-item z2 shape-L"></div> <div class="fill-item z3">üì°</div> <div class="fill-item z4 shape-circle"></div>
  <div class="fill-item z5">üéÆ</div> <div class="fill-item z6">üìö</div> <div class="fill-item z7 shape-rect"></div>
  <div class="fill-item z8">üíª</div> <div class="fill-item z9 shape-L"></div> <div class="fill-item z10">üí°</div> <div class="fill-item z11">‚úèÔ∏è</div>
  <div class="fill-item z12">üéí</div> <div class="fill-item z13 shape-rect"></div> <div class="fill-item z14">üéß</div> <div class="fill-item z15 shape-dot"></div>
  <div class="fill-item z16">üçî</div> <div class="fill-item z17">üç™</div> <div class="fill-item z18">üöÄ</div> <div class="fill-item z19">üëü</div>
  <div class="fill-item z20">üëï</div> <div class="fill-item z21 shape-circle"></div> <div class="fill-item z22">üì∑</div> <div class="fill-item z23">‚òï</div> <div class="fill-item z24 shape-L"></div>

  <main class="relative z-10 px-10 py-6">
    
    <header class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-bold flex items-center gap-2">üõí CampusCart</h1>
      <div class="flex items-center gap-6">
        <span class="text-xl">üîî</span>
        <div class="w-9 h-9 bg-black rounded-full flex items-center justify-center text-white cursor-pointer hover:bg-gray-800 transition">üë§</div>
      </div>
    </header>

    <div class="mb-4">
      <input type="text" id="search-input" placeholder="Search Chargers, Maggi, books..." class="w-full md:w-[420px] px-4 py-3 rounded-xl outline-none shadow-sm focus:shadow-md transition bg-white/90 backdrop-blur-sm" />
    </div>

    <div class="flex gap-3 mb-6 overflow-x-auto pb-2 scrollbar-hide" id="category-filters">
      <span class="category-pill bg-[#FFC94A] px-4 py-1 rounded-full text-sm font-medium border border-black/5 hover:bg-[#ffb915] transition whitespace-nowrap" data-category="Tech">+ Tech</span>
      <span class="category-pill bg-[#FFC94A] px-4 py-1 rounded-full text-sm font-medium border border-black/5 hover:bg-[#ffb915] transition whitespace-nowrap" data-category="Food">+ Food</span>
      <span class="category-pill bg-[#FFC94A] px-4 py-1 rounded-full text-sm font-medium border border-black/5 hover:bg-[#ffb915] transition whitespace-nowrap" data-category="Books">+ Books</span>
      <span class="category-pill bg-[#FFC94A] px-4 py-1 rounded-full text-sm font-medium border border-black/5 hover:bg-[#ffb915] transition whitespace-nowrap" data-category="Free">+ Free</span>
    </div>

    <section class="mb-10">
      <h2 class="font-bold text-lg">Available near you</h2>
      <p class="text-sm mb-4 text-black/70">Items from block A</p>

      <div id="items-container" class="flex gap-6 overflow-x-auto pb-8 pt-2">
        <div class="text-gray-600">Loading items...</div>
      </div>
    </section>

    <a href="/post" class="fixed bottom-6 right-6 bg-black text-white px-6 py-3 rounded-full shadow-2xl z-50 transform transition-transform duration-200 hover:scale-110 active:scale-95 font-semibold flex items-center gap-2">
      <span class="text-xl">+</span> Post
    </a>
    
  </main>

  <script>
    let allItems = [];
    let selectedCategory = '';
    let searchQuery = '';

    async function loadItems() {
      const container = document.getElementById('items-container');
      
      try {
        const response = await fetch('/items');
        allItems = await response.json();
        renderItems();
      } catch (error) {
        console.error('Error loading items:', error);
        container.innerHTML = `
          <div class="text-red-600 font-medium">Failed to load items. Please try again later.</div>
        `;
      }
    }

    function renderItems() {
      const container = document.getElementById('items-container');
      
      // Filter items based on search and category
      let filteredItems = allItems.filter(item => {
        const matchesSearch = searchQuery === '' || 
          item.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
          (item.description && item.description.toLowerCase().includes(searchQuery.toLowerCase()));
        
        const matchesCategory = selectedCategory === '' || 
          item.category === selectedCategory;
        
        return matchesSearch && matchesCategory;
      });

      if (filteredItems.length === 0) {
        container.innerHTML = `
          <div class="bg-[#FFC94A]/50 w-[180px] rounded-2xl p-4 flex-shrink-0 flex items-center justify-center border-2 border-dashed border-black/10">
            <span class="text-gray-800 font-medium text-center">No items found. Try a different search or filter.</span>
          </div>
        `;
        return;
      }

      const itemsHTML = filteredItems.map(item => `
        <div class="bg-[#FFC94A] w-[180px] rounded-2xl p-4 flex-shrink-0 shadow-lg transform transition-all duration-300 hover:-translate-y-2 hover:shadow-2xl cursor-pointer">
          <div class="w-full h-24 bg-white/40 rounded-lg mb-2 flex items-center justify-center">
            <span class="text-3xl">${getCategoryEmoji(item.category)}</span>
          </div>
          <p class="font-bold truncate">${escapeHTML(item.title)}</p>
          <p class="text-sm font-medium opacity-80">Price: Rs.${item.price}</p>
          <button onclick="window.location.href='/item?id=${item.id}'" class="bg-black text-white w-full mt-3 py-2 rounded-xl text-sm font-semibold transition-transform duration-200 hover:scale-110 active:scale-95">
            View
          </button>
        </div>
      `).join('');

      container.innerHTML = itemsHTML + `
        <div class="bg-[#FFC94A]/50 w-[180px] rounded-2xl p-4 flex-shrink-0 flex items-center justify-center border-2 border-dashed border-black/10 transform transition-all duration-300 hover:scale-105">
          <span class="text-gray-800 font-medium">More coming...</span>
        </div>
      `;
    }

    function getCategoryEmoji(category) {
      const emojis = {
        'Tech': 'üíª',
        'Food': 'üçï',
        'Books': 'üìö',
        'Fashion': 'üëï',
        'Free': 'üéÅ',
        'Daily Use': 'üéß'
      };
      return emojis[category] || 'üì¶';
    }

    function escapeHTML(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    // Search functionality
    document.getElementById('search-input').addEventListener('input', function(e) {
      searchQuery = e.target.value;
      renderItems();
    });

    // Category filter functionality
    document.querySelectorAll('.category-pill').forEach(pill => {
      pill.addEventListener('click', function() {
        const clickedCategory = this.dataset.category;
        
        // Toggle: if clicking the same category, deselect it
        if (selectedCategory === clickedCategory) {
          selectedCategory = '';
          this.classList.remove('active');
        } else {
          // Remove active from all pills
          document.querySelectorAll('.category-pill').forEach(p => p.classList.remove('active'));
          // Add active to clicked pill
          this.classList.add('active');
          selectedCategory = clickedCategory;
        }
        
        renderItems();
      });
    });

    document.addEventListener('DOMContentLoaded', loadItems);
  </script>
</body>
</html>